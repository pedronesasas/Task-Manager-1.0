<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Tarefas - UI/UX Front-end</title>

    <!-- Fonte Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Config Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        gray: {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            300: '#D1D5DB',
                            400: '#9CA3AF',
                            500: '#6B7280',
                            600: '#4B5563',
                            800: '#1F2937',
                            900: '#111827'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .custom-checkbox {
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.25em;
            height: 1.25em;
            border: 2px solid #D1D5DB;
            border-radius: 0.375rem;
            display: grid;
            place-content: center;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .custom-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 0.2s transform ease-in-out;
            box-shadow: inset 1em 1em white;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked {
            background-color: #2563EB;
            border-color: #2563EB;
        }
        .custom-checkbox:checked::before { transform: scale(1); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }

        @keyframes highlight {
            from { background-color: #eff6ff; }
            to { background-color: transparent; }
        }
        .highlight { animation: highlight 0.6s ease-out; }
    </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans text-gray-800 antialiased flex items-center justify-center p-4 sm:p-8">

<!-- Main Container -->
<div class="w-full max-w-4xl bg-white rounded-2xl shadow-xl shadow-gray-200/50 overflow-hidden border border-gray-100 flex flex-col">

    <!-- Header -->
    <div class="px-6 py-6 border-b border-gray-100 flex justify-between items-center bg-white">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Minhas Tarefas</h1>
            <p class="text-sm text-gray-500 mt-1">Gestão rápida com subtarefas.</p>
        </div>
        <div class="bg-blue-50 text-blue-700 text-xs font-semibold px-3 py-1 rounded-full border border-blue-100">
            <span id="task-count">0</span> Pendentes
        </div>
    </div>

    <!-- Input -->
    <div class="px-6 py-4 bg-gray-50 border-b border-gray-100">
        <textarea
            id="new-task-input"
            placeholder="[ID],[Título],[Prazo],[Prioridade],[Detalhes]\n-Subtarefa 1\n-Subtarefa 2\n\nPressione Enter para adicionar tudo"
            class="w-full min-h-[120px] p-3 text-sm bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-400 placeholder-gray-400"
        ></textarea>

        <p class="text-[10px] text-gray-400 mt-2 pl-1">
            Exemplo:<br>
            142,Voxuy,14h dia 13,alta,fazer junto do João<br>
            -Conferir automação<br>
            -Testar checkout<br>
        </p>
    </div>

    <!-- Task List -->
    <div id="task-list" class="divide-y divide-gray-50 overflow-y-auto flex-grow bg-white"></div>

    <div class="bg-gray-50 px-6 py-4 text-center text-xs text-gray-400 border-t border-gray-100">
        Clique para concluir • Seta para expandir • "x" remove tudo
    </div>
</div>

<script>
/* DATA */
let tasks = [];
let lastAddedId = null;
let isToggling = false;

const taskList = document.getElementById("task-list");
const taskCount = document.getElementById("task-count");

/* ICONS */
const icons = {
    clock: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
    trash: `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6l1-2h4l1 2"/></svg>`,
    arrowRight: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><polyline points="5 3 12 7 5 11"/></svg>`,
    arrowDown: `<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 5 7 12 11 5"/></svg>`
};

const priorityStyles = {
    urgente: "bg-red-50 text-red-600 border-red-200",
    alta: "bg-amber-50 text-amber-600 border-amber-200",
    normal: "bg-blue-50 text-blue-600 border-blue-200",
    baixa: "bg-gray-50 text-gray-600 border-gray-200"
};

/* INPUT HANDLER */
document.getElementById("new-task-input").addEventListener("keydown", function (e) {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        processInput(this.value.trim());
        this.value = "";
    }
});

/* PROCESS MULTILINE */
function processInput(text) {
    const lines = text.split("\n").map(l => l.trim()).filter(l => l);

    let currentTask = null;

    lines.forEach(line => {
        if (!line.startsWith("-")) {
            const parts = line.split(",").map(p => p.trim());
            const [id, title, deadline, priority, detail] = parts;

            currentTask = {
                id: Number(id),
                title: title || "",
                deadline: deadline || "Hoje",
                priority: (priority || "Normal").toLowerCase(),
                detail: detail || "",
                expanded: true,
                completed: false,
                subtasks: []
            };

            tasks.push(currentTask);
            lastAddedId = currentTask.id;
        } else {
            currentTask.subtasks.push({
                title: line.replace(/^-/, "").trim(),
                completed: false
            });
        }
    });

    renderTasks();
}

/* RENDER */
function renderTasks() {
    taskList.innerHTML = "";
    let pending = 0;

    const sorted = [...tasks].sort((a, b) => a.id - b.id);
    const fragment = document.createDocumentFragment();

    sorted.forEach((task, index) => {
        if (!task.completed) pending++;

        const taskRow = document.createElement("div");

        taskRow.className =
            "p-5 transition border-l-4 " +
            (task.completed ? "opacity-50 grayscale bg-gray-50 scale-[0.98]" :
                              "bg-white hover:shadow-sm hover:border-blue-500") +
            (!isToggling ? " animate-fade-in" : "");

        taskRow.style.animationDelay = `${index * 40}ms`;

        taskRow.innerHTML = `
            <div class="flex items-start justify-between w-full">
                <div class="flex gap-4 flex-1 items-start">

                    <input type="checkbox" class="custom-checkbox mt-1"
                        ${task.completed ? "checked" : ""}
                        onclick="toggleTask(${task.id}); event.stopPropagation();">

                    <button onclick="toggleExpand(${task.id}); event.stopPropagation();" 
                        class="mt-1 text-gray-400 hover:text-gray-600">
                        ${task.expanded ? icons.arrowDown : icons.arrowRight}
                    </button>

                    <div class="flex flex-col flex-1">
                        <span class="font-bold text-sm ${task.completed ? 'line-through text-gray-500' : ''}">
                            ${task.title}
                        </span>
                        <span class="text-xs text-gray-400 ${task.completed ? 'line-through' : ''}">
                            ${task.detail}
                        </span>
                    </div>
                </div>

                <div class="flex gap-3 items-center">

                    <div class="flex items-center text-xs text-gray-500">
                        ${icons.clock} ${task.deadline}
                    </div>

                    <span class="px-2 py-1 rounded-full text-[10px] uppercase font-bold border 
                        ${priorityStyles[task.priority] || priorityStyles.normal}">
                        ${task.priority}
                    </span>

                    <button onclick="deleteTask(${task.id}); event.stopPropagation();" 
                        class="text-gray-400 hover:text-red-500">
                        ${icons.trash}
                    </button>
                </div>
            </div>

            <div id="sub-${task.id}" class="${task.expanded ? '' : 'hidden'} mt-3 pl-10 flex flex-col gap-2">
                ${task.subtasks
                    .map((st, i) => `
                        <label class="flex gap-3 items-center text-sm">
                            <input type="checkbox" 
                                class="custom-checkbox"
                                ${st.completed ? "checked" : ""}
                                onclick="toggleSubtask(${task.id}, ${i}); event.stopPropagation();">

                            <span class="${st.completed ? 'line-through text-gray-400' : ''}">
                                ${st.title}
                            </span>
                        </label>
                    `)
                    .join("")}
            </div>
        `;

        fragment.appendChild(taskRow);
    });

    taskList.appendChild(fragment);
    taskCount.textContent = pending;
}

/* INTERACTIONS */
function toggleExpand(id) {
    const task = tasks.find(t => t.id === id);
    task.expanded = !task.expanded;
    renderTasks();
}

function toggleTask(id) {
    isToggling = true;
    const task = tasks.find(t => t.id === id);
    task.completed = !task.completed;
    renderTasks();
    isToggling = false;
}

function toggleSubtask(id, index) {
    isToggling = true;
    const task = tasks.find(t => t.id === id);
    task.subtasks[index].completed = !task.subtasks[index].completed;
    renderTasks();
    isToggling = false;
}

function deleteTask(id) {
    tasks = tasks.filter(t => t.id !== id);
    renderTasks();
}

/* INIT */
renderTasks();
</script>

</body>
</html>
